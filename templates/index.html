<!DOCTYPE html>
<html lang="en">

<head>
	<title>Deep Whaling</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://use.fontawesome.com/3cfd69bfa7.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script>
		$(document).ready(function() {
			var layers = $(".layer");
			for (var i = 0; i < layers.length; i++) {
				link_layer(layers[i]);
			}
		});
		var counter = 1;

		function link_layer(layer) {
			var selector = findClass(layer, "layer-type");
			selector.addEventListener("change", function() {
				var denseoptions = findClass(layer, "layer-dense-options");
				var convoptions = findClass(layer, "layer-convolutional2d-options");
				var pooloptions = findClass(layer, "layer-maxpooling-options");
				denseoptions.style.display = 'none';
				convoptions.style.display = 'none';
				pooloptions.style.display = 'none';
				switch (selector.value) {
					case "dense":
						denseoptions.style.display = 'block';
						break;
					case "conv2d":
						convoptions.style.display = 'block';
						break;
					case "pool":
						pooloptions.style.display = 'block';
						break;
				}
			});

			//TODO add new layer onclick listener to + button
			var new_button = findClass(layer, "new-button");
			new_button.addEventListener("click", function() {
				addLayer(layer);
			})
			//TODO add delete onclick listener to X button

		}

		function addLayer(pre_layer) {
			var layer = document.createElement("div");
			console.log(pre_layer);
			document.getElementById("layers_contain").insertBefore(layer, pre_layer.nextSibling);
			layer.className = "well well-lg layer";
			layer.id = "active";
			//There's probably a better way to do this
			$("#active").html(
			'<div class="form-group">\
				<div class="Row">\
				  <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">\
				    <label for="layer">Layer</label>\
				  </div>\
				  <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 alignright">\
				    <div class="material-icons new-button">add</div>\
				    <div class="material-icons del-button">clear</div>\
				  </div>\
				  <div class="form-group layer-types">\
				    <label>Layer type:</label>\
				    <select class="form-control layer-type">\
				      <option value="dense">Dense</option>\
				      <option value="conv2d">Convolutional 2D</option>\
				      <option value="pool">Max Pooling</option>\
				    </select>\
				  </div>\
				  <div class="layer-dense-options">\
				    <label>Number of neurons:</label>\
				    <input type="text" value="10" class="form-control dense-size">\
				  </div>\
				  <!-- hidden by default -->\
				    <div class="layer-convolutional2d-options"  style="display: none;">\
				    <div class="row">\
				      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">\
				        <label>Filter size:</label>\
				        <div class="row">\
				          <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">\
				            <div class="input-group">\
				              <span class="input-group-addon" id="basic-addon1">X</span>\
				              <input type="text" value="5" class="form-control filter-size-x">\
				            </div>\
				          </div>\
				          <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">\
				            <div class="input-group">\
				              <span class="input-group-addon" id="basic-addon1">Y</span>\
				              <input type="text" value="5" class="form-control filter-size-y">\
				            </div>\
				          </div>\
				        </div>\
				      </div>\
				      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">\
				        <label>Stride:</label>\
				        <div class="row">\
				          <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">\
				            <div class="input-group">\
				              <span class="input-group-addon" id="basic-addon1">X</span>\
				              <input type="text" value="1" class="form-control conv-stride-x">\
				            </div>\
				          </div>\
				          <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">\
				            <div class="input-group">\
				              <span class="input-group-addon" id="basic-addon1">Y</span>\
				              <input type="text" value="1" class="form-control conv-stride-y">\
				            </div>\
				          </div>\
				        </div>\
				      </div>\
				    </div>\
				    <br>\
				    <label>Number of filters:</label>\
				    <input type="text" value="10" class="form-control convolutional-size">\
				  </div>\
				  <!-- hidden by default -->\
				  <div class="layer-maxpooling-options" style="display: none;">\
				    <label>Stride:</label>\
				    <div class="row">\
				      <div class="col-xs-6 col-sm-12 col-md-6 col-lg-6">\
				        <div class="input-group">\
				          <span class="input-group-addon" id="basic-addon1">X</span>\
				          <input type="text" value="1" class="form-control conv-stride-x">\
				        </div>\
				      </div>\
				      <div class="col-xs-6 col-sm-12 col-md-6 col-lg-6">\
				        <div class="input-group">\
				          <span class="input-group-addon" id="basic-addon1">Y</span>\
				          <input type="text" value="1" class="form-control conv-stride-y">\
				        </div>\
				      </div>\
				    </div>\
				  </div>\
				</div>\
			</div>'
			);
			layer.id = "inactive";
			link_layer(layer);
		}

		function makeid() {
			var text = "";
			var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

			for (var i = 0; i < 10; i++)
				text += possible.charAt(Math.floor(Math.random() * possible.length));

			return text;
		}

		//TODO update to use new layer configuration
		function form_to_json() {
			var room = makeid();

			var data = {
				"layers": [],
				"iterations": 0,
				"dataset": "----",
				"room": room
			};
			var count = 1;
			var layer = document.getElementById("layer" + count);
			while (layer != null) {
				data["layers"].push({
					"size": parseInt(layer.value)
				});
				count += 1;
				layer = document.getElementById("layer" + count);
			}
			data["iterations"] = parseInt(document.getElementById("iters").value);
			data["dataset"] = document.getElementById("dataset").value;

			var xhr = new XMLHttpRequest();
			xhr.open("POST", "/runnetwork", true);
			xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

			// send the collected data as JSON
			xhr.send(JSON.stringify(data));

			xhr.onloadend = function() {
				// done
			};
			window.location.href = "/results?room=" + room;
		}

		// http://stackoverflow.com/questions/12166753/how-to-get-child-element-by-class-name#12166811
		function findClass(element, className) {
			var foundElement = null,
				found;

			function recurse(element, className, found) {
				for (var i = 0; i < element.childNodes.length && !found; i++) {
					var el = element.childNodes[i];
					var classes = el.className != undefined ? el.className.split(" ") : [];
					for (var j = 0, jl = classes.length; j < jl; j++) {
						if (classes[j] == className) {
							found = true;
							foundElement = element.childNodes[i];
							break;
						}
					}
					if (found)
						break;
					recurse(element.childNodes[i], className, found);
				}
			}
			recurse(element, className, false);
			return foundElement;
		}
	</script>
	<style>
		.row.content {
			height: 450px
		}

		.sidenav {
			padding-top: 20px;
			background-color: #f1f1f1;
			height: 100%;
		}

		.main-body {
			overflow: auto;
			padding-bottom: 100px;
			height: 100%;
		}

		.alignright {
			text-align: right;
		}

		footer {
			position: fixed;
			bottom: 0;
			width: 100%;
			background-color: #555;
			color: white;
			padding: 15px;
			margin-top: -95px;
			height: 95px;
		}

		@media screen and (max-width: 767px) {
			.sidenav {
				height: auto;
				padding: 15px;
			}
			.row.content {
				height: auto;
			}
		}
	</style>
</head>

<body>

	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Logo</a>
			</div>
			<div class="collapse navbar-collapse" id="myNavbar">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">Home</a></li>
					<li><a href="results.html">Progress/Results</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="https://www.holbertonschool.com"><span class="#"></span> Holberton School</a></li>
					<li><a href="https://www.docker.com"><span class="#"></span> Docker</a></li>
					<li><a href="https://github.com/butcallmeJo/DockerCon-Challenge"><span class="#"></span> Project on Github</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container main-body">
		<div class="row">
			<div class="col-sm-12 text-left">
				<h1>Deep Whaling</h1>
				<h4>About:</h4>
				<p><strong>Deep Whaling</strong> is an open source GUI to run <a href="http://keras.io/">Keras</a>, a highly modular neural networks library while running in a <a href="https://www.docker.com">Docker</a> container. This makes <strong>Deep Whaling</strong>					a very easy tool to learn about deep learning!</p>
				<h4>How to use <strong>Deep Whaling</strong>:</h4>
				<p>To run <strong>Deep Whaling</strong>, you just have to follow 4 easy steps:</p>
				<ul>
					<li>select the amount of layers you want.</li>
					<li>Input how many neurons you want for each layer</li>
			</div>
		</div>
		<div class="row">
			<form role="form" method="post">
				<div id="layers_contain" class="col-sm-6 text-left">
					<div class="well well-lg layer">
						<div class="form-group">
							<div class="Row">
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<label for="layer">Layer</label>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 alignright">
									<div class="material-icons new-button">add</div>
									<div class="material-icons del-button">clear</div>
								</div>
								<div class="form-group layer-types">
									<label>Layer type:</label>
									<select class="form-control layer-type">
										<option value="dense">Dense</option>
										<option value="conv2d">Convolutional 2D</option>
										<option value="pool">Max Pooling</option>
									</select>
								</div>
								<div class="layer-dense-options">
									<label>Number of neurons:</label>
									<input type="text" value="10" class="form-control dense-size">
								</div>
								<!-- hidden by default -->
								<div class="layer-convolutional2d-options" style="display: none;">
									<!-- <div class="layer-convolutional2d-options" > -->
									<div class="row">
										<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
											<label>Filter size:</label>
											<div class="row">
												<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1">X</span>
														<input type="text" value="5" class="form-control filter-size-x">
													</div>
												</div>
												<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1">Y</span>
														<input type="text" value="5" class="form-control filter-size-y">
													</div>
												</div>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
											<label>Stride:</label>
											<div class="row">
												<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1">X</span>
														<input type="text" value="1" class="form-control conv-stride-x">
													</div>
												</div>
												<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
													<div class="input-group">
														<span class="input-group-addon" id="basic-addon1">Y</span>
														<input type="text" value="1" class="form-control conv-stride-y">
													</div>
												</div>
											</div>
										</div>
									</div>
									<br>
									<label>Number of filters:</label>
									<input type="text" value="10" class="form-control convolutional-size">
								</div>
								<!-- hidden by default -->
								<div class="layer-maxpooling-options" style="display: none;">
									<label>Stride:</label>
									<div class="row">
										<div class="col-xs-6 col-sm-12 col-md-6 col-lg-6">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon1">X</span>
												<input type="text" value="1" class="form-control conv-stride-x">
											</div>
										</div>
										<div class="col-xs-6 col-sm-12 col-md-6 col-lg-6">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon1">Y</span>
												<input type="text" value="1" class="form-control conv-stride-y">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="form-group">

					</div>
				</div>
				<div class="col-sm-6 text-left">
					<div class="well well-lg">
						<div id="datasets" class="form-group">
							<label for="dataset">Select dataset:</label>
							<select class="form-control" id="dataset">
								<option>mnist</option>
								<option>cifar 10</option>
								<option>-</option>
								<option>-</option>
							</select>
						</div>
						<div id="iterations" class="form-group">
							<label for="iters">iterations:</label>
							<input type="text" value="10" class="form-control" id="iters">
							<p> iterations</p>
						</div>
					</div>
				</div>
				<div class="col-sm-12 text-center">
					<button type="button" class="btn btn-success" onclick="form_to_json()">Run Network</button>
				</div>
			</form>
		</div>
	</div>
	<footer class="footer">
		<div class="container-fluid text-left">
			<div class="row">
				<div class="col-sm-3 pull-left">
					<a class="btn btn-block btn-social btn-github" href="https://github.com/johnSerrano">
						<span class="fa fa-github"></span>John Serrano
					</a>
				</div>
				<div class="col-sm-3 pull-right">
					<a class="btn btn-block btn-social btn-github" href="https://github.com/butcallmejo">
						<span class="fa fa-github"></span>Josquin Gaillard
					</a>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-3 pull-left">
					<a class="btn btn-block btn-social btn-twitter" href="https://twitter.com/johnSerrano2">
						<span class="fa fa-twitter"></span>John Serrano
					</a>
				</div>
				<div class="col-sm-3 pull-right">
					<a class="btn btn-block btn-social btn-twitter" href="https://twitter.com/butcallmejo">
						<span class="fa fa-twitter"></span>Josquin Gaillard
					</a>
				</div>
			</div>
		</div>
	</footer>

</body>

</html>
